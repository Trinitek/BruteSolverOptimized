
#include <stdio.h>
#include <stdint.h>
#include <windows.h>
#include <time.h>

int main(void) {
    
    typedef double (*PERMUTE)(uint64_t array[], uint64_t arrayLength, double distances[]);
    
    HMODULE salesDll = WINAPI LoadLibrary("salesman.dll");
    if (salesDll == NULL) {
        printf("Could not import SALESMAN.DLL: 0x%x\n", GetLastError());
        return 1;
    } else {
        printf("SALESMAN.DLL loaded at %x\n", salesDll);
    }
    
    FARPROC testcall = WINAPI GetProcAddress(salesDll, "testcall");
    if (testcall == NULL) {
        printf("Could not find 'testcall' in library: 0x%x\n", GetLastError());
        return 1;
    } else {
        printf("'testcall' found at %x\n", testcall);
    }
    printf("testcall(34) returns %d\n", (uint64_t)testcall(34));
    
    PERMUTE permute = (PERMUTE) GetProcAddress(salesDll, "permute");
    if (permute == NULL) {
        printf("Could not find 'permute' in library: 0x%x\n", GetLastError());
        return 1;
    } else {
        printf("'permute' found at %x\n", permute);
    }
    
    uint64_t arrayLength = 9;
    uint64_t array[9] = {0, 1, 2, 3, 4, 5, 6, 7, 8};
	double distances[100] = {
        0.0, 96.17692030835673, 300.66759053812234, 273.12268305653413, 292.1711826994579, 47.92702786528704, 313.0255580619576, 312.0288448204749, 227.27076362788065, 167.59773268156107
        ,96.17692030835673, 0.0, 368.9728987337688, 233.46520083301493, 197.06344156134085, 96.21330469326995, 218.27734651126764, 286.27259736132623, 292.09929818470977, 105.01904589168576
        ,300.66759053812234, 368.9728987337688, 0.0, 342.29957639471303, 518.7957208767243, 274.87451682540524, 533.8464198624919, 322.001552791287, 77.07788269017254, 464.29516473898366
        ,273.12268305653413, 233.46520083301493, 342.29957639471303, 0.0, 235.23605165875404, 228.52789764052878, 240.3018934590404, 62.81719509815764, 282.0638225650358, 323.79777639755343
        ,292.1711826994579, 197.06344156134085, 518.7957208767243, 235.23605165875404, 0.0, 278.28941769316344, 21.840329667841555, 296.7861182737495, 444.07206622349037, 202.5660386145713
        ,47.92702786528704, 96.21330469326995, 274.87451682540524, 228.52789764052878, 278.28941769316344, 0.0, 297.89259809535383, 264.9396157617807, 198.66806487203723, 190.057885919001
        ,313.0255580619576, 218.27734651126764, 533.8464198624919, 240.3018934590404, 21.840329667841555, 297.89259809535383, 0.0, 300.647634283059, 459.76189489778295, 223.64704335179573
        ,312.0288448204749, 286.27259736132623, 322.001552791287, 62.81719509815764, 296.7861182737495, 264.9396157617807, 300.647634283059, 0.0, 272.6059427085184, 381.4249598544909
        ,227.27076362788065, 292.09929818470977, 77.07788269017254, 282.0638225650358, 444.07206622349037, 198.66806487203723, 459.76189489778295, 272.6059427085184, 0.0, 388.5678833871889
        ,167.59773268156107, 105.01904589168576, 464.29516473898366, 323.79777639755343, 202.5660386145713, 190.057885919001, 223.64704335179573, 381.4249598544909, 388.5678833871889, 0.0};
    
    clock_t start, finish;
    start = clock();
    double i = permute(array, arrayLength, distances);
    finish = clock();
    
    printf("Result: %f\n", i);
    printf("Completed in %f milliseconds\n", (double) (finish - start));
    
    return 0;
}
